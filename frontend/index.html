<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì •ë¶€ì§€ì›ì‚¬ì—… ë°ì¼ë¦¬ - ë§¤ì¼ ì—…ë°ì´íŠ¸ë˜ëŠ” ì§€ì›ì‚¬ì—… ì •ë³´</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <h1>ğŸ“° ì •ë¶€ì§€ì›ì‚¬ì—… ë°ì¼ë¦¬</h1>
                </div>
                <div class="header-date" id="currentDate"></div>
            </div>
        </div>
    </header>

    <!-- Stats Banner -->
    <section class="stats-banner">
        <div class="container">
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="newCount">-</div>
                    <div class="stat-label">ì˜¤ëŠ˜ ì‹ ê·œ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="ongoingCount">-</div>
                    <div class="stat-label">ì§„í–‰ì¤‘</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="urgentCount">-</div>
                    <div class="stat-label">ë§ˆê°ì„ë°•</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="totalCount">-</div>
                    <div class="stat-label">ì „ì²´ ê³µê³ </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- New Announcements Section -->
            <section class="section">
                <div class="section-header">
                    <h2>ğŸ”¥ ìµœê·¼ ê³µê³ </h2>
                </div>
                <div class="announcements-grid" id="newAnnouncements">
                    <div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
            </section>

            <!-- Ongoing Announcements Section -->
            <section class="section">
                <div class="section-header">
                    <h2>ğŸ“Œ ë” ë§ì€ ê³µê³ </h2>
                </div>
                <div class="announcements-grid" id="ongoingAnnouncements">
                    <div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>ë§¤ì¼ ìë™ ì—…ë°ì´íŠ¸ | API ì—°ë™ ì™„ë£Œ</p>
            <p class="footer-links">
                <a href="http://localhost:8000/docs" target="_blank">API ë¬¸ì„œ</a>
            </p>
        </div>
    </footer>

    <script>
        // INLINE JavaScript - ìºì‹œ ë¬¸ì œ ìš°íšŒ
        const API_BASE_URL = 'http://localhost:8000/api';

        // ë‚ ì§œ í‘œì‹œ
        function displayCurrentDate() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
            const dateStr = now.toLocaleDateString('ko-KR', options);
            document.getElementById('currentDate').textContent = dateStr;
        }

        // í†µê³„ ë¡œë“œ
        async function loadStats() {
            try {
                const response = await fetch(`${API_BASE_URL}/stats`);
                const data = await response.json();

                document.getElementById('newCount').textContent = data.new_supports || 0;
                document.getElementById('ongoingCount').textContent = data.ongoing_supports || 0;
                document.getElementById('urgentCount').textContent = data.kstartup_supports || 0;
                document.getElementById('totalCount').textContent = data.total_supports || 0;
            } catch (error) {
                console.error('í†µê³„ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ê³µê³  ë¡œë“œ
        async function loadAnnouncements() {
            try {
                const response = await fetch(`${API_BASE_URL}/supports?page=1&size=6`);
                const data = await response.json();

                const container = document.getElementById('newAnnouncements');

                if (data.items && data.items.length > 0) {
                    container.innerHTML = data.items.map(item => `
                        <div class="announcement-card">
                            <div class="card-header">
                                <span class="source-badge ${item.source_api === 'MSIT' ? 'source-msit' : 'source-kstartup'}">
                                    ${item.source_api === 'MSIT' ? 'ê³¼ê¸°ë¶€' : 'K-Startup'}
                                </span>
                            </div>
                            <div class="card-title">${item.title || 'ì œëª© ì—†ìŒ'}</div>
                            <div class="card-description">${item.organization || ''}</div>
                            <div class="card-footer">
                                <div class="card-date">
                                    ${item.created_at ? new Date(item.created_at).toLocaleDateString('ko-KR') : ''}
                                </div>
                                ${item.url ? `<a href="${item.url}" target="_blank" class="btn-view">ìì„¸íˆ ë³´ê¸° â†’</a>` : ''}
                            </div>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = '<div class="loading">ê³µê³ ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                }
            } catch (error) {
                console.error('ê³µê³  ë¡œë“œ ì‹¤íŒ¨:', error);
                document.getElementById('newAnnouncements').innerHTML =
                    '<div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
        }

        // ë” ë§ì€ ê³µê³  ë¡œë“œ
        async function loadMoreAnnouncements() {
            try {
                const response = await fetch(`${API_BASE_URL}/supports?page=2&size=6`);
                const data = await response.json();

                const container = document.getElementById('ongoingAnnouncements');

                if (data.items && data.items.length > 0) {
                    container.innerHTML = data.items.map(item => `
                        <div class="announcement-card">
                            <div class="card-header">
                                <span class="source-badge ${item.source_api === 'MSIT' ? 'source-msit' : 'source-kstartup'}">
                                    ${item.source_api === 'MSIT' ? 'ê³¼ê¸°ë¶€' : 'K-Startup'}
                                </span>
                            </div>
                            <div class="card-title">${item.title || 'ì œëª© ì—†ìŒ'}</div>
                            <div class="card-description">${item.organization || ''}</div>
                            <div class="card-footer">
                                <div class="card-date">
                                    ${item.created_at ? new Date(item.created_at).toLocaleDateString('ko-KR') : ''}
                                </div>
                                ${item.url ? `<a href="${item.url}" target="_blank" class="btn-view">ìì„¸íˆ ë³´ê¸° â†’</a>` : ''}
                            </div>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = '<div class="loading">ê³µê³ ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                }
            } catch (error) {
                console.error('ê³µê³  ë¡œë“œ ì‹¤íŒ¨:', error);
                document.getElementById('ongoingAnnouncements').innerHTML =
                    '<div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
        }

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            displayCurrentDate();
            loadStats();
            loadAnnouncements();
            loadMoreAnnouncements();
        });
    </script>
</body>

</html>